version: '3'

services:
    
    jupyter:
        build: ./jupyter
        ports:
           - 8888:8888
        volumes:
           - ./public:/mnt
        links:
           - mongodb

    redis:
        image: redis:latest
        ports:
           - "6379:6379"
        volumes:
           - redis-data:/data
        command: redis-server --appendonly yes
        environment:
           - TZ=Asia/Tokyo 

    get-search-result:
        build: ./get-search-result
        env_file: .env
        ports:
           - "1337:1337"
        links:
           - redis

    collect:
        build: ./collect
        env_file: .env
        links:
           - mongodb
           - get-body
           - get-search-result
    
    get-body:
        build: ./get-body
        env_file: .env
        ports:
           - 8000:8000
        links:
           - redis

    analysis:
        build: ./analysis
        links:
           - mongodb

    mongodb:
        image: mongo:3.4.4
        restart: always
        ports:
            - 27017:27017
        volumes:
            - db-data:/data/db

volumes:
  db-data:
    driver: local
  redis-data:
    driver: local

